@model YSWL.MALL.ViewModel.Shop.ShoppingCartModel
<script type="text/javascript">
    $(function () {
        var selectItem = new Array();
        $(".SalePrice").each(function () {
            var sellprice = $(this).attr("toalSellPrice");
            var adjustedprice = $(this).attr('toalAdjustedPrice');
            var p = parseFloat(sellprice) - parseFloat(adjustedprice);
            if (p > 0) {
                $(this).text(p.toFixed(2));
                $(this).parent().show();
            }
        });
        //填充数组
        $(".btnCheck:checked").each(function () {
            var itemId = $(this).attr("ItemId");
            //判断选中数组中是否已存在该项
            var index = $.inArray(itemId, selectItem);
            if (index > -1) {
                selectItem.splice(index, 1);
            } else {
                selectItem.push(itemId);
            }
        });
        $("#btnRemoveSelect").die("click").live("click", function () {
            if (selectItem == '') {
                ShowFailTip("请选择要删除的商品！");
                return;
            }

            if (!confirm("您确定要删除选中的商品吗？")) {
                return;
            }
            var itemIds = selectItem.join(",");

            $.ajax({
                type: "POST",
                dataType: "text",
                url: "@(ViewBag.BasePath)ShoppingCart/RemoveItem",
                data: { ItemIds: itemIds },
                success: function (data) {
                    switch (data) {
                        case "Yes":
                            $("#LoadCartList").load("@(ViewBag.BasePath)ShoppingCart/CartList?s=" + new Date().format('yyyyMMddhhmmssS'), function () {
                                shopc_h();
                            });
                            break;
                        case "No":
                            ShowFailTip("请选择要删除的商品！");
                            break;
                        default:
                            ShowFailTip("服务器繁忙，请稍候再试！");
                            setTimeout(function () { $("#LoadCartList").load("@(ViewBag.BasePath)ShoppingCart/CartList?s=" + new Date().format('yyyyMMddhhmmssS')); }, 3000);
                            break;

                    }
                }
            });
        });
        if (parseInt($('#SelectedQuantity').attr('Quantity')) < 1) {
            $('#toSettlement').css('cursor', ' not-allowed').attr('href','javascript:;');
            $('#toSettlement').click(function () {
                return false;
            });
        }

    })
</script>

@if (Model != null && Model.AllCartInfo.Quantity > 0)
{
    <div class="cart-thead clearfix">
        <div class="column t-checkbox form">
            <span><a href="javascript:;" id="btnRemoveAll" style="color:#1859a5">清空购物车</a></span>

        </div>
        <div class="column t-goods">
            商品名称</div>
        <div class="column t-price">
            单价</div>
        <div class="column t-promotion">
            数量</div>
        <div class="column t-quantity">
            小计</div>
        <div class="column t-action">
            操作</div>
    </div> 
    
    <div id="product-list" class="cart-tbody">
        @foreach (var item in Model.AllCartInfo.Items)
        {
            <div class="item shopc_item  @if (item.Stock < item.Quantity || item.SaleStatus != 1)
                                                                                   { @: set_grey
                                                                                   }else{
                                @: item_selected
                              }" >
										   
										  
		    
                <div class="item_form clearfix">
                    <div class="cell p-checkbox">
                      @if(item.SaleStatus!=1){
                        @:<div class="gl_invalid">失效</div>
                    }
                        <input @(item.Selected ? "checked='checked'" : "") class="checkbox btnCheck" type="checkbox" ItemId="@item.ItemId"  ></div>
                    <div class="cell p-goods">
                        <div class="p-img">
                            <a href="@(ViewBag.BasePath)Product/Detail/@item.ProductId">
                                <img width="52" height="52" src="@YSWL.MALL.Web.Components.FileHelper.GeThumbImage(item.ThumbnailsUrl, "T115X115_")" alt="">
                            </a>
                        </div>
                        <div class="pName">
                            <a href="@(ViewBag.BasePath)Product/Detail/@item.ProductId">
                                @item.Name
                            </a><span class="promise411">
                                @if (item.SkuValues != null && item.SkuValues.Length > 0)
                                {

                                    foreach (string val in item.SkuValues)
                                    {
                                    @(val+ " " )
                                    }

                                }
                            </span>
                        </div>
                    </div>
                    <div class="cell p-price">
                        <span class="price">￥@item.AdjustedPrice.ToString("F")</span></div>
                    <div class="cell p-quantity"  style="line-height: normal;">
                        <div class="quantity-form" ItemId="@item.ItemId">
                            <a href="javascript:;"  class="decrement " ItemId="@item.ItemId" >-</a>
                            <input maxlength="3"  ItemId="@item.ItemId" type="text" class="quantity-text txtQuantity" value="@item.Quantity"  ItemId="@item.ItemId"  >
                            <a href="javascript:;" ItemId="@item.ItemId" class="increment" stock="@item.Stock">+</a>
                        </div>
                        @if (item.SaleStatus == 1)
                        {
                            if (item.Stock <= 0)
                            {
                                <span class="red">
                                    无货
                                </span>
                            }
                            else if (item.Stock < item.Quantity)
                            {
                                <span class="red">
                                    库存不足
                                </span>
                            }
                            else
                            {
                                <span>
                                    有货
                                </span>
                            }
                        }
                    </div>
                    <div class="cell p-inventory">
                        ￥@((item.AdjustedPrice * item.Quantity).ToString("F"))</div>
                    <div class="cell p-remove">@*<a class="cart-collection" href="#">收藏</a>*@
                    <a class="cart-remove btnDelete" href="javascript:;" ItemId="@item.ItemId">删除</a>
                    </div>
                </div>
                <div class="item_extra">
                    <div class="sku-yanBao newJdService clearfix">
                    </div>
                </div>
            </div>
        }
        <!--item2结束-->
    </div>  
    <!--controlWrap开始-->
    <div class="controlWrap">
        <div class="control">
            <div class="controlL">
 

                <span class="allChoose">
                    <input data-cart="toggle-cb" name="toggle-checkboxes"  
                        type="checkbox"   id="btnCheckAll"   @(Model.SelectedCartInfo.Quantity == Model.AllCartInfo.Quantity ? "checked='checked'" : "")   >
                    <label for="btnCheckAll">
                        全选
                    </label>
                </span><span class="delete" id="btnRemoveSelect"><a href="javascript:;" >删除选中项</a> </span><span class="shopping"><b></b>
                    <a href="@(ViewBag.BasePath)Product">继续购物</a> </span>
            </div>
            <div class="controlR" id="SelectedQuantity" Quantity="@Model.SelectedCartInfo.Quantity">
                应付金额（不含运费）：<span data-bind="@Model.SelectedCartInfo.TotalAdjustedPrice.ToString("F")">¥@Model.SelectedCartInfo.TotalAdjustedPrice.ToString("F")</span></div>
        </div>
        <div class="jiesuan">
            <a href="@(ViewBag.BasePath)Order/SubmitOrder" id="toSettlement"></a>
        </div>
    </div>       
    <!--controlWrap结束-->
}
else
{
    <div class="cart-inner cart-empty">
        <div class="message">
            <ul>
                <li>购物车内暂时没有商品。</li>
                <li>去<a href="@(ViewBag.BasePath)Product" >商品频道</a>挑选喜欢的商品</li>
            </ul>
        </div>
    </div>
    <script type="text/javascript">
        $('#shopc_msg').hide();
    </script>
}
 