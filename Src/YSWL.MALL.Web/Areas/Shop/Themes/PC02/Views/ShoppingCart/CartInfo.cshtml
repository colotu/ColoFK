@{
    Layout = "~/Areas/Shop/Themes/PC02/Views/Shared/_ShoppingLayout.cshtml";
}
<script src="/Scripts/jquery.cookie.js" type="text/javascript"></script>
<script type="text/javascript">
    pagename = "cart_list";
    $(function () {
        //购物车中有商品数据时显示
        shopc_h();

        $(".decrement").die("click").live("click", function () {
            var count = parseInt($(this).next().val());
            if (count == 1) {
                if (confirm("您确定要删除该商品吗？")) {
                    $(".btnDelete[ItemId='" + $(this).attr("ItemId") + "']").click();
                    // $(this).parents('.gouwuchelist').find('.btnDelete').click();
                }
            } else {
                $(this).next().val(count - 1);
                var itemId = $(this).parent().attr("ItemId");
                $.ajax({
                    type: "POST",
                    dataType: "text",
                    async: false,
                    url: "@(ViewBag.BasePath)ShoppingCart/UpdateItemCount?s=" + new Date().format('yyyyMMddhhmmssS'),
                    data: { ItemId: itemId, Count: count - 1 },
                    success: function (data) {
                        if (data != "No") {
                            $("#LoadCartList").load("@(ViewBag.BasePath)ShoppingCart/CartList?s=" + new Date().format('yyyyMMddhhmmssS'));
                        } else {
                            ShowFailTip("服务器繁忙，请稍候再试！");
                        }
                    }
                });
            }
        });
        $('.txtQuantity').die("blur").live("blur", function () {
            var count = parseInt($(this).val());
            if (count < 1) {
                if (confirm("您确定要删除该商品吗？")) {
                    $(".btnDelete[ItemId='" + $(this).attr("ItemId") + "']").click();
                    return;
                }
                $(this).val(1);
                return;
            }
            var itemId = $(this).attr("ItemId");
            $.ajax({
                type: "POST",
                dataType: "text",
                url: "@(ViewBag.BasePath)ShoppingCart/UpdateItemCount?s=" + new Date().format('yyyyMMddhhmmssS'),
                data: { ItemId: itemId, Count: count },
                success: function (data) {
                    if (data != "No") {
                        $("#LoadCartList").load("@(ViewBag.BasePath)ShoppingCart/CartList?s=" + new Date().format('yyyyMMddhhmmssS'));
                    } else {
                        ShowFailTip("服务器繁忙，请稍候再试！");
                    }
                }
            });
        });
        $(".increment").die("click").live("click", function () {
            var count = parseInt($(this).prev().val());
             var itemId = $(this).attr("ItemId");
            var stock = $(this).attr("stock");
            if (stock <= 0) {
                ShowFailTip("无货");
                return;
            }
            if (stock < (count + 1)) {
                ShowFailTip("库存不足！");
                return;
            }
            $(this).prev().val(count + 1);
           
            $.ajax({
                type: "POST",
                dataType: "text",
                async: false,
                url: "@(ViewBag.BasePath)ShoppingCart/UpdateItemCount?s=" + new Date().format('yyyyMMddhhmmssS'),
                data: { ItemId: itemId, Count: count + 1 },
                success: function (data) {
                    if (data != "No") {
                        $("#LoadCartList").load("@(ViewBag.BasePath)ShoppingCart/CartList?s=" + new Date().format('yyyyMMddhhmmssS'));
                    } else {
                        ShowFailTip("服务器繁忙，请稍候再试！");
                    }
                }
            });
        });

        //清空购物车
        $("#btnRemoveAll").die("click").live("click", function () {
            if (!confirm("您确定要清空购物车吗？")) {
                return;
            }
            $.ajax({
                type: "POST",
                dataType: "text",
                url: "@(ViewBag.BasePath)ShoppingCart/ClearShopCart",
                data: {},
                success: function (data) {
                    if (data != "No") {
                        $("#LoadCartList").load("@(ViewBag.BasePath)ShoppingCart/CartList?s=" + new Date().format('yyyyMMddhhmmssS'), function () {
                            shopc_h();
                        });
                    } else {
                        ShowFailTip("服务器繁忙，请稍候再试！");
                        setTimeout(function () { $("#LoadCartList").load("@(ViewBag.BasePath)ShoppingCart/CartList?s=" + new Date().format('yyyyMMddhhmmssS')); }, 3000);
                    }
                }
            });
        });

        //全选
        $("#btnCheckAll").die("click").live("click", function () {
            var option;
            if ($(this).attr("checked") == "checked") {
                option = "check";
            } else {
                option = "remove";
            }

            $.ajax({
                type: "POST",
                dataType: "text",
                url: "@(ViewBag.BasePath)ShoppingCart/SelectedItemAll",
                data: { option: option },
                success: function (data) {
                    if (data == "OK") {
                        $("#LoadCartList").load("@(ViewBag.BasePath)ShoppingCart/CartList?s=" + new Date().format('yyyyMMddhhmmssS'));
                    } else {
                        ShowFailTip("服务器繁忙，请稍候再试！");
                        setTimeout(function () { $("#LoadCartList").load("@(ViewBag.BasePath)ShoppingCart/CartList?s=" + new Date().format('yyyyMMddhhmmssS')); }, 3000);
                    }
                }
            });
        });





        $(".btnDelete").die("click").live("click", function () {
            if (!confirm("您确定要删除吗？")) {
                return;
            }
            var itemId = $(this).attr("ItemId");
            $.ajax({
                type: "POST",
                dataType: "text",
                url: "@(ViewBag.BasePath)ShoppingCart/RemoveItem",
                data: { ItemIds: itemId },
                success: function (data) {
                    if (data != "No") {
                        $("#LoadCartList").load("@(ViewBag.BasePath)ShoppingCart/CartList?s=" + new Date().format('yyyyMMddhhmmssS'), function () {
                            shopc_h();
                        });
                    } else {
                        ShowFailTip("服务器繁忙，请稍候再试！");
                        setTimeout(function () { $("#LoadCartList").load("@(ViewBag.BasePath)ShoppingCart/CartList?s=" + new Date().format('yyyyMMddhhmmssS')); }, 3000);
                    }
                }
            });
        });

        //.btnCheck

        //$(".danxuan input[type=checkbox]").die("click").live("click", function () {
        $(".btnCheck").die("click").live("click", function () {
            var itemId = $(this).attr("ItemId");
            $.ajax({
                type: "POST",
                dataType: "text",
                url: "@(ViewBag.BasePath)ShoppingCart/SelectedItem",
                data: { id: itemId },
                success: function (data) {
                    if (data == "OK") {
                        $("#LoadCartList").load("@(ViewBag.BasePath)ShoppingCart/CartList?s=" + new Date().format('yyyyMMddhhmmssS'));
                    } else {
                        ShowFailTip("服务器繁忙，请稍候再试！");
                        setTimeout(function () { $("#LoadCartList").load("@(ViewBag.BasePath)ShoppingCart/CartList?s=" + new Date().format('yyyyMMddhhmmssS')); }, 3000);
                    }
                }
            });
        });


        //开启分仓
        if ($('#hdIsMultiDepot').length > 0 && $('#hdIsMultiDepot').val().toLocaleLowerCase() == "true") {
            loadDeliveryAreas();
        }

    });

    //设置购物车页配送地区
    function setCartListDeliveryAreas(regoinId) {
        setDeliveryAreas(regoinId);
        $("#LoadCartList").load("@(ViewBag.BasePath)ShoppingCart/CartList?s=" + new Date().format('yyyyMMddhhmmssS'));
    }

    function shopc_h() {
        //购物车中有商品数据时显示
        if ($('.shopc_item').length > 0) {
            $('#shopc_msg').show();
        } else {
            $('#shopc_msg').hide();
        }
    }
</script>
   <div id="shopc_msg" style="display:none;width: 980px;background: ##fff;
margin: 10px auto 30px;
padding: 0px 5px 2px;">
                @if (ViewBag.IsMultiDepot) { 
                  <div style="float: right;">
                  @Html.Partial("/Areas/Shop/Themes/PC02/Views/Partial/_RegoinLayer.cshtml")
                </div>
                }
        </div>


<div class="cart-inner">

  
    <!--item开始-->  
    <div id="LoadCartList">
      @Html.Action("CartList", "ShoppingCart")
         </div>
    <!--item结束-->

</div>

                    @Html.Action("ProductRec", "Partial", new { Type = YSWL.MALL.Model.Shop.Products.ProductRecType.Recommend, Cid = 0, Top = 4, ViewName = "_CartInfoRec" })
