@{
    Layout = "~/Areas/MBShop/Themes/Y1/Views/Shared/_NoFootLayout.cshtml";
    ViewBag.Title = "购物车";
}
<script type="text/javascript">
    $(function () {
        $(document).on("click", ".redu", function () {
            var count = parseInt($(this).next().val());
            if (count == 1) {
                if (confirm("您确定要删除该商品吗？")) {
                    $(this).parents('.gouwuchelist').find('.btnDelete').click();
                }
            } else {
                $(this).next().val(count - 1);
                var itemId = $(this).parent().attr("ItemId");
                $.ajax({
                    type: "POST",
                    dataType: "text",
                    async: false,
                    url: $YSWL.BasePath + "ShoppingCart/UpdateItemCount?s=" + new Date().format('yyyyMMddhhmmssS'),
                    data: { ItemId: itemId, Count: count - 1 },
                    success: function (data) {
                        if (data != "No") {
                            $("#LoadCartList").load($YSWL.BasePath + "ShoppingCart/CartList?s=" + new Date().format('yyyyMMddhhmmssS'));
                        } else {
                            AlertWarning("服务器繁忙，请稍候再试！");
                        }
                    }
                });
            }
        });

        $(document).on("click", ".add", function () {
            var count = parseInt($(this).prev().val());
            $(this).prev().val(count + 1);
            var itemId = $(this).parent().attr("ItemId");
            var stock = $(this).parent().attr("stock");
            if (stock <= 0) {
                AlertWarning("无货");
                return;
            }
            if (stock < (count + 1)) {
                AlertWarning("库存不足！");
                return;
            }
            $.ajax({
                type: "POST",
                dataType: "text",
                async: false,
                url: $YSWL.BasePath + "ShoppingCart/UpdateItemCount?s=" + new Date().format('yyyyMMddhhmmssS'),
                data: { ItemId: itemId, Count: count + 1 },
                success: function (data) {
                    if (data != "No") {
                        $("#LoadCartList").load($YSWL.BasePath + "ShoppingCart/CartList?s=" + new Date().format('yyyyMMddhhmmssS'));
                    } else {
                        AlertWarning("服务器繁忙，请稍候再试！");
                    }
                }
            });
        });
        $(document).on("blur", ".txtQuantity", function () {
            var count = parseInt($(this).val());
            if (count < 1) {
                if (confirm("您确定要删除该商品吗？")) {
                    $(this).parents('.gouwuchelist').find('.btnDelete').click();
                    return;
                }
                $(this).val(1);
                return;
            }
            var itemId = $(this).parent().attr("ItemId");
            $.ajax({
                type: "POST",
                dataType: "text",
                url: $YSWL.BasePath + "ShoppingCart/UpdateItemCount?s=" + new Date().format('yyyyMMddhhmmssS'),
                data: { ItemId: itemId, Count: count },
                success: function (data) {
                    if (data != "No") {
                        $("#LoadCartList").load($YSWL.BasePath + "ShoppingCart/CartList?s=" + new Date().format('yyyyMMddhhmmssS'));
                    } else {
                        AlertWarning("服务器繁忙，请稍候再试！");
                    }
                }
            });
        });

    });

    function GoSubmit() {
        var content = $('.cart_checkbox_active').siblings('.shp_cart_opt').find('em').text();
        if (content.indexOf("库存不足") != -1) {
            AlertWarning("存在库存不足的商品");
            return;
        }
        location.href = $YSWL.BasePath + "Order/SubmitOrder";
        return;
    }

</script>

 
<!--START HEADER-->
<header class="m_header">
    <div class="navbar-fixed-top">
        <div class="m_header_bar">
            <div class="m_icon_goback icon" onclick="history.go(-1);">
                <span></span>
            </div>
            <p class="m_header_title">购物车</p>
            @*<div class="m_icon_share icon">
                <span></span>
            </div>*@
        </div>
    </div>
</header>
<!-- END HEADER -->
<div id="LoadCartList">
    @Html.Action("CartList", "ShoppingCart")
</div>
<input type="hidden" value="s_cart" id="hidPage" />
<script>

    $(function () {
        $('body').addClass("bg");
    });
</script>