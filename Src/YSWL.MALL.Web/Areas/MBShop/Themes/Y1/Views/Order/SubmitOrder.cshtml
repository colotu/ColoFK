@{
    Layout = "~/Areas/MBShop/Themes/Y1/Views/Shared/_NoFootLayout.cshtml";
    var shopid = Request.QueryString["shopid"];
}
@section head{
    <script src="/Scripts/jquery/jquery.guid.js" type="text/javascript"></script>
    <script src="/Scripts/jquery/maticsoft.selectregion.js" handle="/RegionHandle.aspx"  isnull="true" type="text/javascript"></script>
    <script src="/Scripts/jquery.cookie.js" type="text/javascript"></script>
}
@section foot{ 
    <link href="/Scripts/jqueryui/red/jquery-ui-1.9.2.min.css" rel="stylesheet" type="text/css" />
    <script src="/Scripts/jqueryui/jquery-ui-1.9.2.min.js" type="text/javascript"></script>
    <script src="/Scripts/jquery/maticsoft.browser.js"></script>
   <script src="/Scripts/jqueryui/maticsoft.jqueryui.dialog.min.js" type="text/javascript"></script>
    <script src="/Areas/MBShop/Themes/Y1/Content/Scripts/Pay/SubmitOrder.js" type="text/javascript"></script>
    <script type="text/javascript">
        $("body").addClass("bg");
        $('#fade').css('height', document.body.scrollHeight);
        $(function () {
            $('#order-submit').click(function () {
                var addressId = $('#step-1 .address_info').attr("addressId");
                if (!addressId || addressId < 1) {
                    $.alertEx('请修改收货人信息!', function () {
                        $('#step-1').effect('highlight', 1000);
                    });
                    return false;
                }
                var payId = $('#step-2').find('#PaymentModeId').val();
                if (!payId || payId < 1) {
                    $.alertEx('请修改支付方式后提交订单!', function () {
                        $('#step-2').effect('highlight', 1000);
                    });
                    return false;
                }
                var shipId = $('#step-2').find('#ShippingTypeId').val();
                if (!shipId || shipId < 1) {
                    $.alertEx('请修改配送方式后提交订单!', function () {
                        $('#step-2').effect('highlight', 1000);
                    });
                    return false;
                }
                var conpon = $("#hfcoupon").val();
                SubmitOrder(this, addressId, shipId, payId, conpon);
            });
        });

        function invoiceToggle() {
            if ($('#div_expan').hasClass('into')) {
                $('#div_invoice_info').show(300);
                $('#div_expan').removeClass('into').addClass('into_open');
            } else {
                $('#div_invoice_info').hide(300);
                $('#div_expan').removeClass('into_open').addClass('into');
            }
        }


        //获取要购买的商品的库存
        //function GetBuyProdStock() {
        //    $.ajax({
        //        type: "POST",
        //        dataType: "json",
        //        url: $YSWL.BasePath + "Order/GetBuyProdStock",
        //        async: false,
        //        success: function (resultJson) {
        //            if (resultJson.STATUS == "OK") {
        //                var datajson = $.parseJSON(resultJson.DATA);
        //                var isShow = false;
        //                var htmlstr = '<span class="gou_title" style="color: #F00;">缺货及失效商品</span> <div class="gou_nrtext"  style="background: none;padding: 6px 5px 0 6px;">';
        //                for (var i = 0; i < datajson.length; i++) {
        //                    if (parseInt(datajson[i].salestatus) != 1 || parseInt(datajson[i].stock) <= 0 || parseInt(datajson[i].stock) < parseInt(datajson[i].quantity)) {//无效 无货 库存不足
        //                        htmlstr += ' <div   class="so_f_left">   <img   width="50" height="50" src="' + datajson[i].pic.format('T50X65_') + '"/></div>';
        //                        isShow = true;
        //                    }  
        //                }
        //                htmlstr += '</div>';
        //                if (isShow) {
        //                    $('#products_nostock_tip').html(htmlstr).show();
        //                } else {
        //                    $('#products_nostock_tip').html('').hide();
        //                }
        //            }
        //        }
        //    });
        //}
    </script>
}
@model YSWL.MALL.Model.Shop.Products.ShoppingCartInfo
<input  type="hidden" id="hidUseCoupon" value="@ViewBag.PromotionsIsUseCoupon"/>
<input  type="hidden" id="hdIsMultiDepot" value ="@ViewBag.IsMultiDepot"/>
 <input type="hidden" id="SkuInfo" value="@ViewBag.SkuInfo" />
<input type="hidden" id="SkuCount" value="@ViewBag.SkuCount" />
<input type="hidden" id="ProSale" value="@ViewBag.ProSale" />
<input type="hidden" id="GroupBuy" value="@ViewBag.GroupBuy" />

<!--START HEADER-->
<header class="m_header">
    <div class="navbar-fixed-top">
        <div class="m_header_bar">
            <div class="m_icon_goback icon" onclick="history.go(-1);">
                <span></span>
            </div>
            <p class="m_header_title">填写订单</p>
        </div>
    </div>
</header>
<!-- END HEADER -->
<div class="common_wrap mt44 mb50">
    <div class="menu_list" id="step-1">
        @Html.Action("ShowAddress", "Order",new {shopid=shopid })
    </div>
    <div class="menu_list" id="step-2">
        @Html.Action("ShowPayAndShip", "Order")
    </div>
    <div class="menu_list">
        <input type="text" class="input-lg reg_input" id="txtRemark" placeholder="订单备注">
    </div>
    <div class="menu_list">
            <div class="menu_item pl10" onclick="invoiceToggle()">
                <span>发票信息</span>
                <div class="into icon" id="div_expan">
                    <span ></span>
                </div>
            </div>
            <div class="" id="div_invoice_info" style="display:none;">
               <input type="text" class="input-lg reg_input" style="border:0"  id="txtInvoiceHeader"  placeholder="发票抬头"> 
              <input type="text" class="input-lg reg_input" style="border:0"   id="txtInvoiceContent"   placeholder="发票内容"> 
            </div>
    </div>
    <div class="menu_list">
            <div class="item_addr">
                <div class="menu_item pl10">
                    <span>订单金额</span>
                    @*<div class="into icon">
                        <span></span>
                    </div>*@
                </div>
                <div class="address_info">
                    <p>商品金额：￥@ViewBag.ProductTotal.ToString("F")</p>
                    <p>
                        + 运费：
                        <span class="price" id="freightPriceId" freightPrice="0">￥@ViewBag.Freight.ToString("F")</span>
                    </p>
                    <p>
                        - 促销：
                        <span id="promotionsPriceId">￥@ViewBag.TotalPromPrice.ToString("F")</span>
                    </p>
                    <p style="display:none;">
                        - 优惠：
                        <span id="couponPriceId" couponPrice="0">￥0.00</span>
                    </p>
                </div>
            </div>
    </div>
   <div id="submit_message"></div>
</div>

@*<!--赠品-->
<div id="activList"></div>
<!--赠品-->*@

<!--底部悬浮导航-->
<div class="shp_cart_bottom">
    <nav class="navbar-fixed-bottom navbar_bottom_wrap">
        <div class="payment_total navbar_bottom navbar_bottom_payment bg_transparent font_white">
            <span>应付：</span>
            <span  id="payPriceId"  BasePrice="@ViewBag.TotalPrice" >￥@ViewBag.TotalPrice.ToString("F")</span>
        </div>
        <div class="btn_right">
            <a href="javascript:;" class="navbar_bottom_settlement navbar_bottom bg_red" id="order-submit">
                <span class="font_white" >提交订单</span>
            </a>
        </div>
    </nav>
</div>
 <div id="fade" class="black_overlay" style="z-index: 1099;    opacity: 0;"></div>

















