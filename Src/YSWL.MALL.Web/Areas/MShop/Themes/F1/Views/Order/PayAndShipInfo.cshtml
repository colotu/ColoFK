@{
    Layout = "~/Areas/MShop/Themes/F1/Views/Shared/_BaseLayout.cshtml";
}
@section head{
    <script src="/Scripts/jquery/jquery.guid.js" type="text/javascript"></script>
    <script src="/Scripts/jquery.cookie.js" type="text/javascript"></script>
}
@model YSWL.MALL.ViewModel.Shop.PayAndShip
 
<div data-role="content" class="ui-content" role="main">
    <div class="contact-info step-content"  id="step-2">												
        <ul data-role="listview" data-inset="true" data-theme="d" class="ui-listview ui-listview-inset ui-corner-all ui-shadow">
            <li data-role="list-divider" role="heading" class="ui-li ui-li-divider ui-bar-b ui-first-child">支付及配送方式</li>
            <li style="padding: 5px 10px 5px 10px" class="ui-li ui-li-static ui-btn-up-d ui-last-child" id="payment-ship">
                
            
                    <table style="padding: 0; margin: 0; width: 100%;" >
                        <tbody class="consignee-form" id="consignee-form">
                 
                            <tr class="payment">
                                <td class="item">
                                    <p style="margin-top:5px;"><label  class="ui-input-text">支付方式：</label></p>
                                    @if (Model.ListPaymentMode != null && Model.ListPaymentMode.Count > 0)
                                    {
                                        foreach (YSWL.Payment.Model.PaymentModeInfo item in Model.ListPaymentMode)
                                        {
                                            <input type="radio" name="payment" payname="@item.Name" id="pay-method-@item.ModeId" class="hookbox" value="@item.ModeId"/>
                                            <label for="pay-method-@item.ModeId">
                                                @item.Name
                                            </label>
                                        }
                                    }
                                </td>
                            </tr>
                  	
                            <tr id="shipment">
                                <td>
                               <p style="margin-top:5px;"> <label  class="ui-input-text">配送方式：</label></p> 
                                        <div id="subway-sment" >
                            <div class="mc form">
                                <div  id="pickSiteInfo">
                                    @if (Model.ListShippingType != null && Model.ListShippingType.Count > 0)
                                    {
                                        foreach (YSWL.MALL.Model.Shop.Shipping.ShippingType item in Model.ListShippingType)
                                        {
                                            <div class="item  item-selected"> 
                                                    <input name="pick" id="shipping-type-@item.ModeId" class="hookbox" value="@item.ModeId" type="radio"/>
                                                    <label for="shipping-type-@item.ModeId">
                                                        @item.Name</label>
                                            </div>
                                        }
                                    }
                                </div>
                            
                        </div>
                                    </div>
                                </td>
                            </tr>
                            
                           
                        </tbody></table>
        
         
                    
             
                
        
            </li>
        </ul>
       
        <div  >
             <a data-role="button" href="javascript:;"  onclick=" Save_PayAndShip(this) "   data-theme="b" data-corners="true" data-shadow="true" data-iconshadow="true" data-wrapperels="span" class="ui-btn ui-btn-up-b ui-shadow ui-btn-corner-all">
                <span class="ui-btn-inner"><span class="ui-btn-text">保存支付及配送方式</span></span>
            </a>
            <div class="loading loading-1" style="display: none">
                <b></b>正在提交信息，请等待！</div>
        </div>
           
        
    </div>
 
 
</div>

@if (Model.CurrentPaymentMode != null)
{
    <script type="text/javascript">
        $('#step-2 .payment :radio[value=@(Model.CurrentPaymentMode.ModeId)]').attr('checked', 'checked').parents('.item:eq(0)').addClass('item-selected');
    </script>
}
@if (Model.CurrentShippingType != null)
{
    <script type="text/javascript">
        $('#step-2 #shipment .item-selected :radio[value=@(Model.CurrentShippingType.ModeId)]').attr('checked', 'checked').parents('.item:eq(0)').addClass('item-selected');
    </script>
}
<script type="text/javascript">
    $('#step-2 .payment :radio').unbind('click').bind('click', function () {
        var payId = $(this).val();
        $.cookie('m_so_payId', payId, { expires: 1, path: '/' }); //记录payId
        window.location.href = $YSWL.BasePath + 'Order/PayAndShipInfo?payId=' + payId;
    });
    $('#step-2 #shipment .item-selected :radio').unbind('click').bind('click', function () {
        $('#step-2 #shipment .item-selected :radio').removeAttr('checked').parents('.sment-box:eq(0)>.item').removeClass('item-selected');
        $(this).attr('checked', 'checked').parents('.item:eq(0)').addClass('item-selected');
    });
    function Save_PayAndShip(sender) {
        $(sender).hide();
        $(sender).next().show();

        var payId = $('#step-2 .payment :radio:checked').val();
        var shipId = $('#step-2 #shipment .item-selected :radio:checked').val();
        $.cookie('m_so_payId', payId, { expires: 1, path: '/' }); //记录payId
        $.cookie('m_so_shipId', shipId, { expires: 1, path: '/' }); //记录shipId
        window.location.href = $YSWL.BasePath + "Order/SubmitOrder"; 
    }
</script>
