@using YSWL.MALL.Model.Shop.Order
@using Webdiyer.WebControls.Mvc
@model PagedList<YSWL.MALL.Model.Shop.Order.OrderInfo>
     
        @if (Model != null)
        {
            foreach (var item in Model)
            {
                <ul data-role="listview" data-inset="true" data-theme="d" class="ui-listview ui-listview-inset ui-corner-all ui-shadow">
                    <li style="padding: 5px 10px 5px 10px" class="ui-li ui-li-static ui-btn-up-d ui-first-child ui-last-child font_family_sans" >
                        <table style="padding: 0; margin: 0; width: 100%;">
                            <tbody><tr >
                                       <td class="align_right align_top" width="80px"><label class="ui-input-text">订单编号：</label></td>
                                       <td>
                                           <label class="ui-input-text">@item.OrderCode </label>  
                                       </td>
                                   </tr>
                                <tr >
                                    <td class="align_right align_top" width="80px"><label class="ui-input-text">订单金额：</label></td>
                                    <td>
                                        <label class="ui-input-text">￥@item.Amount.ToString("F") </label>  
                                    </td>
                                </tr>
                                <tr class="order_list_item_line">
                                    <td class="align_right align_top" width="80px"><label class="ui-input-text">下单时间：</label></td>
                                    <td>
                                        <label class="price ui-input-text" > @item.CreatedDate.ToString("yyyy-MM-dd HH:mm:ss")</label>
                                    </td>
                                </tr>
                                
                                @*是否拆单模式*@
                                @if (item.HasChildren && (item.PaymentStatus > 1 || (item.PaymentGateway == "cod" || item.PaymentGateway == "bank")))
                                {
                                    for (int i = 0; i < item.SubOrders.Count; i++)
                                    {
                                        <tr class="order_list_img"> 
                                            <td  colspan="2" >
                                                @if (item.SubOrders[i].OrderItems != null && item.SubOrders[i].OrderItems.Count > 0)
                                                {
                                                    foreach (var orderItem in item.SubOrders[i].OrderItems)
                                                    {
                                                        <a href="@(ViewBag.BasePath)p/d/@orderItem.ProductId" target="_blank" rel="external" style="text-decoration: none;" class="img-box" clstag="click|keycount|orderinfo|order_product" target="_blank">
                                                            <img title="@orderItem.Name" src="@YSWL.MALL.Web.Components.FileHelper.GeThumbImage(orderItem.ThumbnailsUrl, "T50X65_")" width="50" height="65"  onerror=" this.onerror = '';this.src = '/Content/themes/base/Shop/images/none.png' " />
                                                        </a>
                                                    }
                                                }
                                             
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="align_right align_top" width="80px"><label class="ui-input-text">订单状态：</label></td>
                                            <td  >
                                                <label class="ui-input-text" id="promotionsPriceId"> @YSWL.MALL.Web.Areas.MShop.Controllers.UserCenterController.GetOrderType(item.SubOrders[i].PaymentGateway, item.SubOrders[i].OrderStatus, item.SubOrders[i].PaymentStatus, item.SubOrders[i].ShippingStatus) </label>  
                                            </td>
                                        </tr>
                                        <tr >
                                            <td class="align_right align_top" width="80px"><label class="ui-input-text">操作：</label></td>
                                            <td>
                                                @switch (YSWL.MALL.Web.Areas.MShop.Controllers.UserCenterController.GetOrderMainStatus(item.PaymentGateway, item.OrderStatus, item.PaymentStatus, item.ShippingStatus))
                                                {
                                                    case EnumHelper.OrderMainStatus.Shiped: //已发货
                                                        <a href="javascript:;"  itemid="@item.SubOrders[i].OrderId" rel="external" data-role="button" data-inline="true" data-mini="true" data-theme="e" data-corners="true" data-shadow="true" data-iconshadow="true" data-wrapperels="span" class="ui-btn ui-btn-up-e ui-shadow ui-btn-corner-all ui-mini ui-btn-inline btnOrderComplete">
                                                            <span class="ui-btn-inner"><span class="ui-btn-text">确认收货</span></span>
                                                        </a>
                                                        break;
                                                }  
                                               
                                                <a href="@(ViewBag.BasePath)O/oi/@item.SubOrders[i].OrderId" rel="external" data-role="button" data-inline="true" data-mini="true" data-theme="e" data-corners="true" data-shadow="true" data-iconshadow="true" data-wrapperels="span" class="ui-btn ui-btn-up-e ui-shadow ui-btn-corner-all ui-mini ui-btn-inline">
                                                    <span class="ui-btn-inner"><span class="ui-btn-text">详情</span></span>
                                                </a>
                                        
                                            </td>
                                        </tr>

                                    }
                                }
                                else
                                {

                                    <tr class="order_list_img"> 
                                        <td  colspan="2" >
                                            @if (item.OrderItems != null && item.OrderItems.Count > 0)
                                            {
                                                foreach (var orderItem in item.OrderItems)
                                                {
                                                    <a href="@(ViewBag.BasePath)p/d/@orderItem.ProductId" target="_blank" rel="external" style="text-decoration: none;" class="img-box" clstag="click|keycount|orderinfo|order_product" target="_blank">
                                                        <img title="@orderItem.Name" src="@YSWL.MALL.Web.Components.FileHelper.GeThumbImage(orderItem.ThumbnailsUrl, "T50X65_")" width="50" height="65"  onerror=" this.onerror = '';this.src = '/Content/themes/base/Shop/images/none.png' " />
                                                    </a>
                                                }
                                            }
                                             
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="align_right align_top" width="80px"><label class="ui-input-text">订单状态：</label></td>
                                        <td  >
                                            <label class="ui-input-text" id="promotionsPriceId"> @YSWL.MALL.Web.Areas.MShop.Controllers.UserCenterController.GetOrderType(item.PaymentGateway, item.OrderStatus, item.PaymentStatus, item.ShippingStatus) </label>  
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="align_right align_top" width="80px"><label class="ui-input-text">操作：</label></td>
                                        <td>
                                            @switch (item.OrderStatus)
                                            {
                                                case (int) EnumHelper.OrderStatus.UnHandle: //未处理
                                                    if (item.PaymentStatus == (int)EnumHelper.PaymentStatus.Unpaid && item.PaymentGateway != "cod" && item.PaymentGateway != "bank")
                                                    {
                                                        <a href="javascript:;"  itemid="@item.OrderId" rel="external" data-role="button" data-inline="true" data-mini="true" data-theme="e" data-corners="true" data-shadow="true" data-iconshadow="true" data-wrapperels="span" class="ui-btn ui-btn-up-e ui-shadow ui-btn-corner-all ui-mini ui-btn-inline btnPayOrder">
                                                            <span class="ui-btn-inner"><span class="ui-btn-text">支付</span></span>
                                                        </a>
                                                        <a href="javascript:;"  itemid="@item.OrderId" rel="external" data-role="button" data-inline="true" data-mini="true" data-theme="e" data-corners="true" data-shadow="true" data-iconshadow="true" data-wrapperels="span" class="ui-btn ui-btn-up-e ui-shadow ui-btn-corner-all ui-mini ui-btn-inline btnOrderCancel">
                                                            <span class="ui-btn-inner"><span class="ui-btn-text">取消</span></span>
                                                        </a>
                                                    }
                                                    break;
                                            }
                                            @switch (YSWL.MALL.Web.Areas.MShop.Controllers.UserCenterController.GetOrderMainStatus(item.PaymentGateway, item.OrderStatus, item.PaymentStatus, item.ShippingStatus))
                                            {
                                                case EnumHelper.OrderMainStatus.Shiped: //已发货
                                                    <a href="javascript:;"  itemid="@item.OrderId" rel="external" data-role="button" data-inline="true" data-mini="true" data-theme="e" data-corners="true" data-shadow="true" data-iconshadow="true" data-wrapperels="span" class="ui-btn ui-btn-up-e ui-shadow ui-btn-corner-all ui-mini ui-btn-inline btnOrderComplete">
                                                        <span class="ui-btn-inner"><span class="ui-btn-text">确认收货</span></span>
                                                    </a>
                                                    break;
                                            }  
                                               
                                            <a href="@(ViewBag.BasePath)O/oi/@item.OrderId" rel="external" data-role="button" data-inline="true" data-mini="true" data-theme="e" data-corners="true" data-shadow="true" data-iconshadow="true" data-wrapperels="span" class="ui-btn ui-btn-up-e ui-shadow ui-btn-corner-all ui-mini ui-btn-inline">
                                                <span class="ui-btn-inner"><span class="ui-btn-text">详情</span></span>
                                            </a>
                                        
                                        </td>
                                    </tr>


                                }
                            </tbody></table>

                    </li>
                </ul>
            }
        }
        else
        {
             <p style="margin-top: 20px; margin-left: 20px; font-size: inherit;">
                亲，您暂时还没有订单哦 <br />
                去<a href="@(ViewBag.BasePath)p"   rel="external" style="clolor:#2489ce;text-decoration: none;">商品频道</a>挑选喜欢的商品  </p>
        }
<div>
     @Ajax.Pager(Model, new PagerOptions
{
    ShowFirstLast = false,
    ShowPrevNext = false,
    ShowDisabledPagerItems = false,
    AlwaysShowFirstLastPageNumber = false,
    PageIndexParameterName = "pageIndex",
    NumericPagerItemCount = 3,
    CurrentPagerItemTemplate = "<p class=\"in_s\">{0}</p>",
    NumericPagerItemTemplate = "<p>{0}</p>",
    NavigationPagerItemTemplate = "<p>{0}</p>",
    CssClass = "in_pages",
     
}).AjaxOptions(a => a.SetUpdateTargetId("LoadOrderList"))

</div>
		   