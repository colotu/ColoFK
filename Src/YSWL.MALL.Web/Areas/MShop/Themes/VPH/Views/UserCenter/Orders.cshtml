 @{
     Layout = "/Areas/MShop/Themes/VPH/Views/Shared/_BaseLayout.cshtml";
     ViewBag.Title = "个人中心-我的订单";
     string ordertype = ViewBag.orderType;
 }
 
<script type="text/javascript" src="/Scripts/jquery.unobtrusive-ajax.min.js"></script>
<script type="text/javascript">
    $(function () {
        if ("@ordertype"== "wpay") {
            $("#LoadOrderList").load($YSWL.BasePath + "UserCenter/GetListFromType/_OrderList?pas=0");
        }
        if ("@ordertype" == "wre") {
            $("#LoadOrderList").load($YSWL.BasePath + "UserCenter/GetListFromType/_OrderList?sps=2");
        }
        if ("@ordertype" == "all") {
            $("#LoadOrderList").load($YSWL.BasePath + "UserCenter/OrderList/_OrderList");
        }
        $(".btnPayOrder").die("click").live("click", function () {
            var id = $(this).attr("itemid");
            if (id) {
                window.location = '/pay/certification' + id + '/' + $YSWL.CurrentArea;
            }
        });
        $(".btnOrderCancel").die("click").live("click", function () {
            var _self = $(this);
            var orderId = _self.attr("itemid");
            var r = confirm("您确认取消订单吗？");
            if (r == true) {
                $.ajax({
                    type: "POST",
                    dataType: "text",
                    timeout: 0,
                    url: $YSWL.BasePath+"UserCenter/CancelOrder",
                    data: { OrderId: orderId },
                    success: function (data) {
                        if (data == "True") {
                            _self.parent().prev().find('strong').text("取消订单");
                            _self.parent().find('.btnPayOrder').remove();
                            _self.remove();
                        } else {
                            ShowFailTip("取消失败，请您刷新一下再试！");
                        }
                    }
                });
            }
        });

        $(".btnOrderComplete").die("click").live("click", function () {
            var _self = $(this);
            var orderId = _self.attr("itemid");
            if (confirm("您确认完成订单吗？")) {
                $.ajax({
                    type: "POST",
                    dataType: "text",
                    timeout: 0,
                    url: "@(ViewBag.BasePath)UserCenter/CompleteOrder",
                    data: { OrderId: orderId },
                    success: function (data) {
                        if (data == "True") {
                            _self.parent().prev().find('strong').text("已完成");
                            _self.remove();
                        } else {
                            ShowFailTip("操作失败，请您刷新一下再试！");
                        }
                    }
                });
            }
        });
    })
</script>
<header id="header" class="header clearfix">
    <div class="head_left fl"><a href="javascript:;" onclick="history.go(-1);"><span class="h_back"></span></a></div>
    <span class="headtit">
        @switch (ordertype)
        {
            case "wpay":
                @:未支付订单
                break;
                case "wre":
                @:待收货订单
                break;
                default:
                @:更多订单
                break;
        }
    </span>
    <div class="head_right fr"><a href="@(ViewBag.BasePath)" mars_sead="nav_home_btn"><span class="h_home"></span></a></div>
</header>

<div class="userinfo clearfix">
    <div class="fl">
        <p class="username">我的订单</p>
    </div>
</div>

<div class="s_links in_user_center" id="LoadOrderList">
</div>

