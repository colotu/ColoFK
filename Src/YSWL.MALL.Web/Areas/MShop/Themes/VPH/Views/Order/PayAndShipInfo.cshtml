@{
    Layout = "~/Areas/MShop/Themes/VPH/Views/Shared/_BaseLayout.cshtml";
  
}
@section head{
    <link href="/Scripts/jqueryui/red/jquery-ui-1.9.2.min.css" rel="stylesheet" type="text/css" />
    <script src="/Scripts/jquery/jquery.guid.js" type="text/javascript"></script>
    <script src="/Scripts/jquery.cookie.js" type="text/javascript"></script>
}
@model YSWL.MALL.ViewModel.Shop.PayAndShip
<header id="header" class="header clearfix">
	    
	    <div class="head_left fl"><a href="javascript:;" onclick="history.go(-1);"><span class="h_back"></span></a></div>
	     <span class="headtit">支付及配送方式</span>
	    <div class="head_right fr"><a href="@(ViewBag.BasePath)"><span class="h_home"></span></a></div>
	</header>
    
<div class="space10"></div>
<div class="connerdiv">
@*支付方式*@
<div class="userdiv" id="payment"  data-cartforms="time">
      <div class="checktit font14"><span class="receive_time"></span>支付方式</div>
      <div class="in_pay clearfix">
          <ul>
                  @if (Model.ListPaymentMode != null && Model.ListPaymentMode.Count > 0)
                  {
                      foreach (YSWL.Payment.Model.PaymentModeInfo item in Model.ListPaymentMode)
                      {
                          <li mars_sead="checkout_receive_anytime_btn"  >
                              <span class="radio-box"></span>
                              <input payname="@item.Name" id="pay-method-@item.ModeId" class="hide" value="@item.ModeId" type="radio" class="hide"> @item.Name
                          </li>
                      }
                  }
                   
          </ul>
      </div>
   </div>

@*配送方式*@
<div class="userdiv" id="shipment"  data-cartforms="time">
      <div class="checktit font14"><span class="receive_time"></span>配送方式</div>
      <div class="in_pay clearfix">
          <ul>
                   @if (Model.ListShippingType != null && Model.ListShippingType.Count > 0)
                                    {
                                        foreach (YSWL.MALL.Model.Shop.Shipping.ShippingType item in Model.ListShippingType)
                                        {
                          <li mars_sead="checkout_receive_anytime_btn">
                              <span class="radio-box"></span>
                              <input  id="shipping-type-@item.ModeId"  value="@item.ModeId"  type="radio" class="hide"> @item.Name
                          </li>
                      }
                  }
                   
          </ul>
      </div>
   </div>

<div class="ui-btn-area">
    <input type="button" data-commit="address" class="btn_red" onclick=" Save_PayAndShip(this) " data-loading-text="正在提交..." value="完成">
</div>
</div>
@if (Model.CurrentPaymentMode != null)
{
    <script type="text/javascript">
        $('#payment .in_pay :radio[value=@(Model.CurrentPaymentMode.ModeId)]').attr('checked', 'checked').prev().addClass('radio-selted');
    </script>
}
@if (Model.CurrentShippingType != null)
{
    <script type="text/javascript">
        $('#shipment .clearfix :radio[value=@(Model.CurrentShippingType.ModeId)]').attr('checked', 'checked').prev().addClass('radio-selted');
    </script>
}
<script type="text/javascript">
//    $('#payment .in_pay :radio').unbind('click').bind('click', function () {
//        $('#payment .in_pay :radio').removeAttr('checked').prev().removeClass('radio-selted');
//        $(this).attr('checked', 'checked').prev().addClass('radio-selted');
//    });

    $('#payment .clearfix li').unbind('click').bind('click', function () {
        //$('#payment .clearfix :radio').removeAttr('checked').prev().removeClass('radio-selted');
        //$(this).addClass('radio-selted').next().attr("checked", "checked");
        var payId = $(this).find(':radio').val();
        $.cookie('m_so_payId', payId, { expires: 1, path: '/' }); //记录payId
        location.href = $YSWL.BasePath + 'Order/PayAndShipInfo?payId=' + payId;

    });
    $('#shipment .clearfix li').unbind('click').bind('click', function () {
        $('#shipment .clearfix :radio').removeAttr('checked').prev().removeClass('radio-selted');
        $(this).find('span').addClass('radio-selted').next().attr("checked", "checked");
    });


    function Save_PayAndShip(sender) {
        $(sender).hide();
        $(sender).next().show();
        var payId = $('#payment .clearfix :radio:checked').val();
        var shipId = $('#shipment .clearfix :radio:checked').val();
        $.cookie('m_so_payId', payId, { expires: 1, path: '/' }); //记录payId
        $.cookie('m_so_shipId', shipId, { expires: 1, path: '/' }); //记录shipId
        window.location.href = $YSWL.BasePath + "Order/SubmitOrder"; 
    }
</script>
