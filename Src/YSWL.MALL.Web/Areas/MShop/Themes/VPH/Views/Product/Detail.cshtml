@{
    Layout = "/Areas/MShop/Themes/VPH/Views/Shared/_ShopBaseLayout.cshtml";
}
@using YSWL.MALL.Model.Shop.Products
@model YSWL.MALL.ViewModel.Shop.ProductModel
<script type="text/javascript">var Shop_BuyMode = '@YSWL.MALL.BLL.SysManage.ConfigSystem.GetValueByCache("Shop_BuyMode")';</script>
<link href="/Scripts/PhotoSwipe/photoswipe.css" rel="stylesheet" type="text/css" />
<link href="/Scripts/PhotoSwipe/styles.css" rel="stylesheet" type="text/css" />
<script src="/Scripts/PhotoSwipe/klass.min.js" type="text/javascript"></script>
<script src="/Scripts/jquery/maticsoft.jquery.min.js" type="text/javascript"></script>
<script src="/Scripts/jquery/maticsoft.img.min.js" type="text/javascript"></script>
<link href="/Areas/MShop/Themes/VPH/Content/Css/productdetail.css" rel="stylesheet"
    type="text/css" />
<link href="/Scripts/jqueryui/base/jquery-ui-1.9.2.min.css" rel="stylesheet" type="text/css" />
<script src="/Scripts/jqueryui/jquery-ui-1.9.2.custom.js" type="text/javascript"></script>
<script src="/Areas/MShop/Themes/VPH/Content/Scripts/productdetail.js" type="text/javascript"></script>
<script src="/Areas/MShop/Themes/VPH/Content/Scripts/SKU.js" type="text/javascript"></script>
<script src="/Scripts/PhotoSwipe/photoswipe.jquery.min.js" type="text/javascript"></script>
<script src="/Scripts/jquery.cookie.js" type="text/javascript"></script>
<style type="text/css">
    .footer {
        display: none!important;
    }
</style>
<script type="text/javascript">
    pagename = "product_detail";
    $(function () {
        $("#body").css("padding-top", "44px");
        GetPvCount(@Model.ProductInfo.ProductId);
        if ("@ViewBag.Spread"== "True") {
            $(".guid-share").show();
        }
        $(".guid-share").click(function() {
            $(this).hide();
        })


	  if(@Model.ProductInfo.SalesType==3){
          $('#btnAddToCart').attr('disabled', 'disabled').addClass('addCart-gray').text('赠品不出售!').attr('itemid','');
          $('#divBuyInfo').hide();
          $('#divSelectInfo').empty();
        }
        if (@Model.ProductInfo.SaleStatus !== 1) {
          $('#btnAddToCart').attr('disabled', 'disabled').addClass('addCart-gray').text('非常抱歉, 此商品已下架!').attr('itemid','');
          $('#divBuyInfo').hide();
          $('#divSelectInfo').empty();
        }
    });
    var GetPvCount = function (pid) {
        $.ajax({
            url: "@(ViewBag.BasePath)Product/GetPvCount",
            type: 'post',
            dataType: 'json',
            timeout: 10000,
            data: {
                pid: pid
            },
            success: function (jsondata) {
                if (jsondata.STATUS == "SUCCESS") {
                    //jsondata.DATA; 将访问数展示到页面上  预留
                }
            },
            error: function (messsage) {
                //alert(messsage);
            }
        });

    };
    (function (window, Util, PhotoSwipe) {
        Util.Events.domReady(function (e) {
            var instance, indicators;
            instance = $(".Touch_mer_smallImg").photoSwipe(
                {
                    target: window.document.querySelectorAll('#goods_images')[0],
                    preventHide: true,
                    autoStartSlideshow: true,
                    captionAndToolbarHide: true,
                    fadeInSpeed:1000,
                    faseOutSpeed:1000,
                    getImageSource: function (obj) {
                        return $(obj).attr("src");
                    },
                    getImageCaption: function (obj) {
                        return $(obj).attr("alt");
                    },
                    getImageMetaData: function (obj) {
                        return {
                            longDescription: obj.getAttribute(obj, 'alt')
                        };
                    }
                }
            );
            indicators = window.document.querySelectorAll('#pro_pagination em');

            // onDisplayImage - set the current indicator
            instance.addEventHandler(PhotoSwipe.EventTypes.onDisplayImage, function (e) {
                var i, len;
                for (i = 0, len = indicators.length; i < len; i++) {
                    indicators[i].setAttribute('class', '');
                }
                indicators[e.index].setAttribute('class', 'on');
               // var src = $("#PhotoSwipeTarget").find(".ps-carousel").find(".ps-carousel-content").find("img").attr("src");
            });
            instance.show(0);
        });

    } (window, window.Code.Util, window.Code.PhotoSwipe));
</script>
<div class="guid-share" style="display: none">
    <img  style="width: 100%;padding-top: 10px "  src="/Areas/MShop/Themes/VPH/Content/images/guidShare.png" alt="@Model.ProductInfo.ProductName" />
</div>
@if (Model != null)
{
		<header id="header" class="header clearfix">
	    <div class="head_left fl"><a href="javascript:;" onclick="history.go(-1)"><span class="h_back"></span></a></div>
	     <span class="headtit" >@Model.ProductInfo.ProductName</span>
	    <div class="head_right fr"><a href="@(ViewBag.BasePath)"><span class="h_home"></span></a></div>
	</header>
    <div class="space10">
    </div> 
 <input id="hdProductId" type="hidden"  value="@Model.ProductInfo.ProductId"/>
    <input id="hdsuppId"   type="hidden" value="@Model.ProductInfo.SupplierId"/>
    <div id="wapModalsbox">
        <div id="goods_detail" class="aposition">
            <div id="goods_images" class="goods_images" style="overflow: hidden; visibility: visible;">
                
                    @if (Model != null && Model.ProductImages != null)
                    {
                        for (var i = 0; i < Model.ProductImages.Count; i++)
                        {
                            <span>
                                <img item="@YSWL.MALL.Web.Components.FileHelper.GeThumbImage(Model.ProductImages[i].ThumbnailUrl1, "T185X254_")" 
                                src="@YSWL.MALL.Web.Components.FileHelper.GeThumbImage(Model.ProductImages[i].ThumbnailUrl1, "T185X254_")"
                                      alt="@Model.ProductInfo.ProductName" class="Touch_mer_smallImg active"  style="display: inline;">
                            </span>
                   
                        }
                    }
           
            </div>

            <div class="slideControl clearfix">
                <!--<a href="#" id="prev" onClick='Touch_ImgReview.prev();return false;'></a>-->
                <div id="pro_pagination">
                    @if (Model != null && Model.ProductImages != null)
                    {
                        foreach (ProductImage productImage in Model.ProductImages)
                        {
                            <em class="on">1</em>
                        }
                    }
                </div>
                <!--<a href="#" id="next" onClick='Touch_ImgReview.next();return false;'></a>-->
            </div>
            <div class="goods_info">
                <form name="cartForm" action=""method="post">
                     @Html.Action("StoreLayer", "Partial", new { suppId = Model.ProductInfo.SupplierId })
                    <h1>
                        @Model.ProductInfo.ProductName</h1>
                    <p class="pricediv clearfix">
                        <span class="g_d_price" id="stylePrice">￥@Model.ProductSkus[0].SalePrice.ToString("F")</span>
                        <span class="prf05"></span><span class="fontstyle">¥@Model.ProductInfo.MarketPrice.Value.ToString("F")</span>
                    </p>
                       @if (Model.ProductSkus[0].RankPrice > 0)
                       {
                           <p class="pricediv clearfix">
                               会员价： <span class="g_d_price" id="rankPrice">￥@Model.ProductSkus[0].RankPrice.ToString("F")</span>
                           </p>
                       }
		       
		         @if (Model.ProductInfo.SaleStatus == 1 && Model.ProductInfo.SalesType == 1 && ViewBag.IsMultiDepot)
               {
                   //已开启了分仓
                    <p class="pricediv clearfix">
                   @Html.Partial("/Areas/MShop/Themes/VPH/Views/Partial/_RegoinLayer.cshtml")
		    </p>
               }
                    <p class="space5">
                    </p>
                    <p class="clear">
                    </p>
                  
                        
                    <div class="choiceOptions c6">
                        <div id="SKUOptions" class="proshowlxtext  " style="padding-left: 0;">
                            @Html.Action("OptionSKU", "Product", new { ProductId = Model.ProductInfo.ProductId, SuppId = Model.ProductInfo.SupplierId, viewName = "_OptionSKU" })
                        </div>

                    </div>
                    <div class="cf mt15" id="divBuyInfo" style="overflow: hidden;">
                        <label for="productCount">
                            <span class="fl">购买件数：</span></label>
                        <div class="fl productCount">
                            <a href="javascript:void(0);" class="subtract" id="subtract" style="height: 20px;border: solid 1px #666;width: auto;font-size: 20px;line-height: 20px;">-</a>
                            <input type="text" id="productCount" class="buyCount valignM text" value="1" style="margin-left: 0;margin-right: 0;min-width: 60px;min-height: 20px;border: 1px solid #808080;">
                            
                            <a href="javascript:void(0);" class="plus" id="plus" style="height: 20px;border: solid 1px #666;width: auto;">+</a>
                        </div>
                        <div class="fl ml15 sku-error-message" style="display: none;">
                            <p class="tipsOrg loud dib">
                            </p>
                        </div>
			 <div   id="div_stock" style="display:none;">（库存<span id="stock_num"></span>件）</div>
                    </div>
                    
                    @Html.Action("ActivityList", "Partial", new { pId = Model.ProductInfo.ProductId, suppId = Model.ProductInfo.SupplierId }) 
                    @Html.Action("WholeSale", new { pId = Model.ProductInfo.ProductId, suppId = Model.ProductInfo.SupplierId})
                    <div class="p_detail_hd">
                        <p class="fontdark">
                            <a href="@(ViewBag.BasePath)product/productdesc/@Model.ProductInfo.ProductId" style="width: 100%;display: block">商品详情<span style="float: right">></span></a>
                        </p>
                        <p style="display: none">
                            <span class="fontdark">商品编号：</span>@Model.ProductInfo.ProductCode</p>
                        @*  @Html.Action("OptionAttr", new { ProductId = Model.ProductInfo.ProductId })*@
                        <div class="Origin" style="border: none;margin: 0;padding: 0;">
                            @Html.Action("ProductRelation", "Product", new { id = Model.ProductInfo.ProductId, Top = 3, viewName = "_ProductRelation" })</div>
                        <div class="dashline3">
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="bottomdiv clearfix">
        <div class="inner clearfix">
            <a class="fl cart_time" href="@(ViewBag.BasePath)sc/ci"><em class="num_cart hide">
</em><span class="carticon fl"></span><span class="num_cunt hide"></span></a>
<a href="javascript:;" class="btn_more" id="btnProductFav" productId="@Model.ProductInfo.ProductId" style="width: 50px;
float: left;margin-left: 10%;">
       <img  src="/Areas/MShop/Themes/VPH/Content/images/icon_concern.png"/>关注</a>
            <div class="fr btn_sure" id="btnAddToCart" DefaultText='@(YSWL.MALL.BLL.SysManage.ConfigSystem.GetValueByCache("Shop_BuyMode") == "BuyNow" ? "立刻购买" : "放入购物车")' productid="@Model.ProductInfo.ProductId">
                @(YSWL.MALL.BLL.SysManage.ConfigSystem.GetValueByCache("Shop_BuyMode") == "BuyNow" ? "立刻购买" : "放入购物车")</div>
        </div>
    </div>
}



