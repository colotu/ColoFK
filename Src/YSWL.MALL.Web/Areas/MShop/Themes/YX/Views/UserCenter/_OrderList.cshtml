@using YSWL.MALL.Model.Shop.Order
@using Webdiyer.WebControls.Mvc
@model PagedList<YSWL.MALL.Model.Shop.Order.OrderInfo>
<p class="order_tit">
    我的订单</p>
@if (Model != null)
{
    <ul>
        @foreach (var item in Model)
        {
            <li class="order_item ">
                <p class="item_tit">
                    订单号 @item.OrderCode<span class="time">@item.CreatedDate.ToString("yyyy-MM-dd")</span>
                </p>
                @*是否拆单*@
                @if (item.HasChildren && (item.PaymentStatus > 1 || (item.PaymentGateway == "cod" || item.PaymentGateway == "bank")))
                {
                    <div class="info">
                        @for (int i = 0; i < item.SubOrders.Count; i++)
                        {
                            <p class="last_status">
                                <strong>@YSWL.MALL.Web.Areas.MShop.Controllers.UserCenterController.GetOrderType(item.SubOrders[i].PaymentGateway, item.SubOrders[i].OrderStatus, item.SubOrders[i].PaymentStatus, item.SubOrders[i].ShippingStatus)</strong>
                            </p>
                            if (item.SubOrders[i].OrderItems != null && item.SubOrders[i].OrderItems.Count > 0)
                            {
                            <div>
                            <ul class="pic_list y_cb">
                                @foreach (var orderItem in item.SubOrders[i].OrderItems)
                                {
                                    <li class="item"><a href="@(ViewBag.BasePath)p/d/@orderItem.ProductId" class="dingdan J_ytag" target="_blank">
                                        <img src="@YSWL.MALL.Web.Components.FileHelper.GeThumbImage(orderItem.ThumbnailsUrl, "T50X65_")" width="70" height="70px;"  onerror=" this.onerror = '';this.src = '/Content/themes/base/Shop/images/none.png' ">
                                    </a></li>
                           
                                }
                            </ul></div>
                           
                            }
                           <div> <p class="checkout">
                                <span style="float: left;">总额： ¥@item.SubOrders[i].Amount.ToString("F")</span>   <span class="num">共@(item.SubOrders[i].OrderItems.Count)件</span> 
                            </p></div>
                            <p class="checkout"  style='@(i!=item.SubOrders.Count-1?"border-bottom: 1px dashed #666;":"")'>
                                @switch (YSWL.MALL.Web.Areas.MShop.Controllers.UserCenterController.GetOrderMainStatus(item.SubOrders[i].PaymentGateway, item.SubOrders[i].OrderStatus, item.SubOrders[i].PaymentStatus, item.SubOrders[i].ShippingStatus))
                                {
                                    case EnumHelper.OrderMainStatus.Shiped://已发货
                                        <a href="javascript:;" class="btnOrderComplete orderType"  itemid="@item.SubOrders[i].OrderId">
                                            确认收货</a>                                                
                                        break;
                                }
                                <a href="@(ViewBag.BasePath)O/oi/@item.SubOrders[i].OrderId"  class="orderType">详情</a>
                            </p>
                        }
                    </div>
                }
                else
                {
                    <div class="info">
                        <p class="last_status">
                            <strong ItemId="@item.OrderId">@YSWL.MALL.Web.Areas.MShop.Controllers.UserCenterController.GetOrderType(item.PaymentGateway, item.OrderStatus, item.PaymentStatus, item.ShippingStatus)</strong>
                        </p>
                      <div>  <ul class="pic_list y_cb">
                            @if (item.OrderItems != null && item.OrderItems.Count > 0)
                            {
                                foreach (var orderItem in item.OrderItems)
                                {
                                <li class="item"><a href="@(ViewBag.BasePath)p/d/@orderItem.ProductId" class="dingdan J_ytag">
                                    <img title="@orderItem.Name" src="@YSWL.MALL.Web.Components.FileHelper.GeThumbImage(orderItem.ThumbnailsUrl, "T50X65_")" width="70" height="70px;"  onerror=" this.onerror = '';this.src = '/Content/themes/base/Shop/images/none.png' " />
                                </a></li>
                                }
                            }
                        </ul></div>
                      <div>  <p class="checkout">
                           <span  style="float: left;">总额： ¥@item.Amount.ToString("F")</span> <span class="num">共@(item.OrderItems.Count)件</span> 
                        </p></div>
                        <p class="checkout">
                            @switch (item.OrderStatus)
                            {
                                case (int)EnumHelper.OrderStatus.UnHandle://未处理
                                    if (item.PaymentStatus == (int)EnumHelper.PaymentStatus.Unpaid && item.PaymentGateway != "cod" && item.PaymentGateway != "bank")
                                    {
                                <a href="javascript:;" class="btnPayOrder orderType" ItemId="@item.OrderId">支付</a>
                                <a href="javascript:;" class="btnOrderCancel orderType"  ItemId="@item.OrderId">取消</a>
                                    }
                                    break;
                            }
                            @switch (YSWL.MALL.Web.Areas.MShop.Controllers.UserCenterController.GetOrderMainStatus(item.PaymentGateway, item.OrderStatus, item.PaymentStatus, item.ShippingStatus))
                            {
                                case EnumHelper.OrderMainStatus.Shiped://已发货
                                <a href="javascript:;" class="btnOrderComplete orderType"  itemid="@item.OrderId">确认收货</a>                                                
                                                                                              break;
                            }
                            <a href="@(ViewBag.BasePath)O/oi/@item.OrderId"  class="orderType">详情</a>
                        </p>
                    </div>
                }
            </li>
        }
    </ul>
}
else
{
    <p class="btn_history">
        您还没有历史订单</p>
}
@Ajax.Pager(Model, new PagerOptions
{
    PageIndexParameterName = "pageIndex",
    NumericPagerItemCount = 3,
    NumericPagerItemTemplate = "<p>{0}</p>",
    NavigationPagerItemTemplate = "<p>{0}</p>",
    CssClass = "in_pages",
     
}).AjaxOptions(a => a.SetUpdateTargetId("LoadOrderList"))
